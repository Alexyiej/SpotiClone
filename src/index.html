<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/assets/styles/main/style.css" rel="stylesheet">
    <link href="/assets/styles/modals/style.css" rel="stylesheet">
    <link href="/assets/styles/songs/style.css" rel="stylesheet">
    <link href="/assets/styles/views/home/style.css" rel="stylesheet">
    <link href="/assets/styles/views/playlist/style.css" rel="stylesheet">
    <link href="/assets/styles/global.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto&display=swap" rel="stylesheet">
    
    <title>SpotiClone</title>
</head>

<body>
    <main >
        <div class="main-section">
            <aside>
                <section>
                    
                    <button class="btn-primary" id="home-btn">
                        <div class="icon-container">
                            <i class="fa-solid fa-house"></i>
                        </div>
                        <span>Home</span>
                    </button>
    
                    <button class="btn-primary">
                        <div class="icon-container">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </div>
                        <span>Search</span>
                    </button>
    
                </section>

                <section>
                    <container class="section-wrapper">
                        <nav >
                            <div class="nav-title">
                                <div class="title">
                                    <div class="icon-container">
                                        <i class="fa-solid fa-bars"></i>
                                    </div>  
                                    <span>Your Library</span>
                                </div>
        
                                <div class="nav-icons">
                                    <div class="icon-container">
                                        <i class="fa-solid fa-plus"></i>
                                    </div>  
                                    <div class="icon-container">
                                        <i class="fa-solid fa-arrow-right" class="icon"></i>
                                    </div>  
                                </div>
                             
                            </div>
                            <div class="filters">
                                <div class="filters-wrapper">
                                    <div class="filter">
                                        <span>Playlists</span>
                                    </div>
                                    <div class="filter">
                                        <span>Podcasts & shows</span>
                                    </div>
                                    <div class="filter">
                                        <span>Albums</span>
                                    </div>
                                    <div class="filter">
                                        <span>Artists</span>
                                    </div>
                                    <div class="filter">
                                        <span>Downloaded</span>
                                    </div>
                                </div>
                            </div>
                        </nav>

                        

                        <div class="playlists-container">
                            <div class="menu">
                                <div>
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                </div>
                                <div>
                                    <span>Recents</span>
                                    <i class="fa-solid fa-border-all"></i>
                                </div>
                            </div>
                            <div class="playlists-wrapper">
    
                            </div>
                        </div>
    
                    </container>
                    
                </section>
    
            </aside>
    
            <section class="main">
                <header id="header-playlist">
                    <div class="menu">
                        <div class="col">
                            <div class="icon-cnt">
                                <i class="fa-solid fa-angle-left"></i>
                            </div>
                            <div class="icon-cnt">
                                <i class="fa-solid fa-angle-right"></i>
                            </div>
                            <span style="display: none">Liked Songs</span>
                        </div>
                        <div class="col">
                            <div class="icon-cnt">
                                <i class="fa-regular fa-bell"></i>
                            </div>
                            <div class="icon-cnt">
                                <i class="fa-solid fa-users"></i>
                            </div>
                            <div class="icon-cnt">
                                <i class="fa-regular fa-user"></i>
                            </div>
                        </div>
                    </div>
                </header>
                <container id="main-content">
                </container>

                <!-- te dwa divy to jest gradient i bialy background -->
                <div id="main-page-gradient" style="display: flex;"></div>
                <div id="main-page-bg" style="display: flex"></div>

            </section>

        </div>

        <!-- footera nie zdazylem niestety -->
        <footer style="display: none;">
            <div class="col"></div>
            <div class="col">
                <div class="col-icon-cont">
                    <div class="icons">
                        <i class="fa-solid fa-shuffle"></i>
                        <i class="fa-solid fa-forward-step fa-rotate-180"></i>
                    </div>
    
                    <div class="play-pause">
                        <i class="fa-solid fa-play"></i>
                    </div>
                    
                    <div class="icons">
                        <i class="fa-solid fa-forward-step"></i>
                        <i class="fa-solid fa-repeat"></i>
                    </div>
                </div>
                <div class="time-bar">
                    <span>2.02</span>
                    <div class="bar"></div>
                    <span>4.45</span>
                </div>
            </div>
            <div class="col"></div>
        </footer>
    </main>

    <div id="modal" style="display: none;">
        <button class="btn-primary" name="create-playlist-btn">Create playlist</button>
    </div>

    <div id="playlist-modal" style="display: none;">
        <button class="btn-primary" name="delete-playlist-btn">Delete</button>
    </div>

    <div id="playlist-edit-box" style="display: none;">
        <form>
            <div>
                <span>Edit details</span>
                <i class="fa-solid fa-x" id="close-icon"></i>
            </div>
            <div>
                <div class="edit-box-icon">
                    <div>
                        <img src="/assets/images/covers/basic-cover.png" alt="">    
                    </div>
                </div>
                <div class="labels">
                    <label id="labelText" class="label-text">Name</label>
                    <input type="text" id="playlistInput" placeholder="Add a name...">
                </div>
            </div>
            <div>
                <button type="button" id="save-btn">Save</button>
            </div>
        </form>

    </div>

    <div id="song-modal" style="display: none;">
        <button class="btn-primary" id="add-to-playlist-btn">
            Add to playlist
            <div id="playlist-container-modal" style="display:none;">
                
            </div>
        </button>
        <button class="btn-primary" id="remove-from-playlist-btn">Remove</button>
    </div>
    <div id="page-tint" style="display: none"></div>
</body>

</html>

<script src="https://kit.fontawesome.com/c52b7a3e6e.js" crossorigin="anonymous"></script>
<script src="./scripts/views.js"></script>
<script src="./scripts/localStorage.js"></script>
<script src="./scripts/playlists.js"></script>
<script src="./scripts/contextmenu.js"></script>
<script src="./scripts/bgColors.js"></script>
<script src="./scripts/songs.js"></script>
<script src="./scripts/homepage.js"></script>
<script src="./scripts/playlistFilters.js"></script>

<script>
    const songsUrl = "/assets/jsons/songs.json"
    const genresUrl = "/assets/jsons/genres.json"

    let songs = []
    let genres = []
    let playlists = []
    let likedSongs = []
    let playListIndex = 0; 
    let clickCounter = 0; 
    let startView = "home"

    async function fetchData(list, url){
        try{
            const response = await fetch(url)
            const data = await response.json()

            for (item in data){
                list.push(data[item])
            }
            
        } catch(error){
            console.log(error)
        }

    }

    async function fetchAll(){
        await fetchData(songs, songsUrl)
        await fetchData(genres, genresUrl)

    }
    async function getSongs(){
        await fetchAll()            
        songs = addSongsDateAdded()
        return songs
    }

    function addSongsDateAdded(){
        const songsWithDateAdded = songs.map(song =>{
            let dateAdded = getRandomDate()
            return { ...song, dateAdded };
        })
        
        return songsWithDateAdded

    }
    function handleScroll() {
        const header = document.getElementById("header-playlist");
        const desc = document.getElementById("sticky-desc");
        const wrapper = document.querySelector(".main");
        
        let scroll = wrapper.scrollTop;
        // header
        if (scroll > 275){  header.style.background = "var(--header)" }
        else{ header.style.background = "none" }

        if (desc === null) return

        if (scroll > 365){ desc.classList.add("sticky") }
        else{ desc.classList.remove("sticky") }
    }
    
    const playlistsWrapper = document.querySelector(".playlists-wrapper");                                                                                      
    const playlistModal = document.getElementById("playlist-modal");                                                                                        
    const view = document.getElementById("main-content");                                                                                       
    const homeBtn = document.getElementById("home-btn");          



    songs = getSongs()
    loadPlaylists()

    generateBgColor();

    handleContainerContextMenu(playlistModal, playlistsWrapper, songs)
    handlePlaylistContextMenu(playlistsWrapper)

    let currentView = getLastView()
    if (currentView === null) currentView = startView

    homeBtn.addEventListener('click', function() {                                                                                      
        showHomeView(view, currentView);                                                                                     
    });     

    if (playlists.length === 0) {
        handleCreateClick(playlists, songs)
        showHomeView(view, currentView)
    } 

    const wrapper = document.querySelector(".main");
    wrapper.addEventListener("scroll", handleScroll); 
    getLiked()
    handlePlaylistView()
    console.log("hjl;dfgghjldshjl;fghjl;")
</script>